<div class="container-fluid py-4">
  <div class="mb-4">
    <h2 class="fw-bold"><i class="bi bi-bag-check"></i> Pedidos Recibidos</h2>
    <p class="text-muted">Gestiona los pedidos de tu comercio</p>
  </div>

  {{#if pedidos.length}}
    <!-- Filtros por estado -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary active" onclick="filtrarPedidos('todos')">
            <i class="bi bi-list-ul"></i> Todos ({{pedidos.length}})
          </button>
          <button type="button" class="btn btn-outline-warning" onclick="filtrarPedidos('pendiente')">
            <i class="bi bi-clock"></i> Pendientes
          </button>
          <button type="button" class="btn btn-outline-info" onclick="filtrarPedidos('en proceso')">
            <i class="bi bi-truck"></i> En Proceso
          </button>
          <button type="button" class="btn btn-outline-success" onclick="filtrarPedidos('completado')">
            <i class="bi bi-check-circle"></i> Completados
          </button>
        </div>
      </div>
    </div>

    <!-- Listado de Pedidos -->
    <div class="row g-3" id="listado-pedidos">
      {{#each pedidos}}
        <div class="col-12 pedido-item" data-estado="{{this.estado}}">
          <div class="card shadow-sm pedido-card">
            <div class="card-body">
              <div class="row align-items-center">
                <!-- Número de Pedido -->
                <div class="col-md-1 text-center">
                  <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                    <strong class="fs-5">#{{@index}}</strong>
                  </div>
                </div>

                <!-- Información del Cliente -->
                <div class="col-md-5">
                  <h6 class="fw-bold mb-1">
                    <i class="bi bi-person-circle"></i> {{this.cliente.nombre}} {{this.cliente.apellido}}
                  </h6>
                  <p class="text-muted mb-1 small">
                    <i class="bi bi-telephone"></i> {{this.cliente.telefono}}
                  </p>
                  <p class="text-muted mb-1 small">
                    <i class="bi bi-box-seam"></i> {{this.productos.length}} {{#if (eq this.productos.length 1)}}producto{{else}}productos{{/if}}
                  </p>
                  <p class="text-muted mb-0 small">
                    <i class="bi bi-calendar"></i> {{formatDate this.fechaHora}}
                  </p>
                </div>

                <!-- Delivery Asignado -->
                <div class="col-md-3 text-center">
                  {{#if this.delivery}}
                    <div class="alert alert-info mb-0 py-2">
                      <small class="d-block"><strong><i class="bi bi-person-badge"></i> Delivery:</strong></small>
                      <small>{{this.delivery.nombre}} {{this.delivery.apellido}}</small>
                    </div>
                  {{else}}
                    <span class="badge bg-secondary">
                      <i class="bi bi-person-x"></i> Sin asignar
                    </span>
                  {{/if}}
                </div>

                <!-- Estado y Total -->
                <div class="col-md-2 text-center">
                  {{#if (eq this.estado "pendiente")}}
                    <span class="badge bg-warning text-dark fs-6 mb-2">
                      <i class="bi bi-clock"></i> Pendiente
                    </span>
                  {{else if (eq this.estado "en proceso")}}
                    <span class="badge bg-info fs-6 mb-2">
                      <i class="bi bi-truck"></i> En Proceso
                    </span>
                  {{else if (eq this.estado "completado")}}
                    <span class="badge bg-success fs-6 mb-2">
                      <i class="bi bi-check-circle"></i> Completado
                    </span>
                  {{/if}}
                  <p class="fw-bold text-success mb-0 fs-5">{{formatCurrency this.total}}</p>
                </div>

                <!-- Botón Ver Detalle -->
                <div class="col-md-1 text-end">
                  <a href="/comercio/pedido/{{this._id}}" class="btn btn-primary">
                    <i class="bi bi-eye"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <div class="card shadow">
      <div class="card-body text-center py-5">
        <i class="bi bi-inbox display-1 text-muted d-block mb-3"></i>
        <h4>No hay pedidos recibidos</h4>
        <p class="text-muted mb-0">Los pedidos que te realicen aparecerán aquí</p>
      </div>
    </div>
  {{/if}}
</div>

<script>
  function filtrarPedidos(estado) {
    const items = document.querySelectorAll('.pedido-item');
    const botones = document.querySelectorAll('.btn-group .btn');
    
    // Actualizar botones activos
    botones.forEach(btn => btn.classList.remove('active'));
    event.target.closest('button').classList.add('active');
    
    // Filtrar pedidos
    items.forEach(item => {
      if (estado === 'todos' || item.dataset.estado === estado) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  }
</script>