<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <a href="/cliente/home" class="btn btn-outline-secondary mb-2">
        <i class="bi bi-arrow-left"></i> Volver
      </a>
      <h2 class="fw-bold mb-0">
        {{#if tipoComercio}}
          {{tipoComercio.nombre}}
        {{else}}
          Comercios
        {{/if}}
      </h2>
      <p class="text-muted mb-0">
        {{cantidadComercios}} {{#if (eq cantidadComercios 1)}}comercio disponible{{else}}comercios disponibles{{/if}}
      </p>
    </div>
  </div>

  <!-- Buscador -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <form action="" method="GET" class="row g-3">
        <div class="col-md-10">
          <input 
            type="text" 
            class="form-control" 
            name="busqueda" 
            placeholder="Buscar comercio por nombre..."
            value="{{busqueda}}"
          >
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-success w-100">
            <i class="bi bi-search"></i> Buscar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Listado de Comercios -->
  {{#if comercios.length}}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {{#each comercios}}
        <div class="col">
          <div class="card h-100 shadow-sm hover-card" style="overflow: hidden; border-radius: 15px;">
            <!-- Imagen de producto destacado (parte superior) -->
            <div style="height: 200px; position: relative; overflow: hidden; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
              {{#if this.imagenDestacada}}
                <img src="{{this.imagenDestacada}}" alt="Producto destacado" style="width: 100%; height: 100%; object-fit: cover;">
              {{else}}
                <!-- Imagen por defecto con gradiente -->
                <div class="d-flex align-items-center justify-content-center h-100">
                  <i class="bi bi-egg-fried" style="font-size: 4rem; color: white; opacity: 0.8;"></i>
                </div>
              {{/if}}
              
              <!-- Botón de favorito flotante -->
              <form action="/cliente/favorito/toggle/{{this._id}}" method="POST" style="position: absolute; top: 10px; right: 10px;">
                <button type="submit" class="btn btn-light rounded-circle shadow-sm" style="width: 40px; height: 40px; padding: 0;">
                  {{#if (includes ../favoritosIds this._id)}}
                    <i class="bi bi-heart-fill text-danger"></i>
                  {{else}}
                    <i class="bi bi-heart"></i>
                  {{/if}}
                </button>
              </form>
            </div>

            <!-- Información del comercio -->
            <div class="card-body pb-2" style="position: relative;">
              <!-- Logo del comercio (superpuesto) -->
              <div style="position: absolute; top: -30px; left: 20px; width: 70px; height: 70px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; overflow: hidden;">
                {{#if this.logoComercio}}
                  <img src="{{this.logoComercio}}" alt="{{this.nombreComercio}}" style="max-width: 90%; max-height: 90%; object-fit: contain;">
                {{else}}
                  <i class="bi bi-shop-window fs-3 text-primary"></i>
                {{/if}}
              </div>

              <!-- Nombre y detalles -->
              <div style="padding-top: 50px;">
                <h5 class="card-title fw-bold mb-2" style="color: #2d3748;">
                  {{this.nombreComercio}}
                </h5>
                
                <div class="d-flex align-items-center text-muted mb-3">
                  <i class="bi bi-clock me-1"></i>
                  <small>{{this.horaApertura}} - {{this.horaCierre}}</small>
                </div>

                <a href="/cliente/catalogo/{{this._id}}" class="btn btn-success w-100 rounded-pill">
                  <i class="bi bi-bag"></i> Ver Menú
                </a>
              </div>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <div class="alert alert-warning text-center shadow-sm">
      <i class="bi bi-search fs-1 d-block mb-3"></i>
      <h4>No se encontraron comercios</h4>
      <p class="mb-0">Intenta con otra búsqueda o vuelve más tarde.</p>
    </div>
  {{/if}}
</div>

<style>
  .hover-card {
    transition: all 0.3s ease;
  }

  .hover-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15) !important;
  }
</style>